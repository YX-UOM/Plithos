#!/usr/bin/env python3
"""
ESG Monitor - Claude Code Version

This version is designed to run inside Claude Code where Claude has access
to web_search and web_fetch tools natively.

Usage in Claude Code:
    > Run the ESG monitor for this week
    > python run_claude_code_monitor.py
"""

# =============================================================================
# CONFIGURATION
# =============================================================================

SEARCH_QUERIES = {
    "news": [
        "ESG real estate news this week",
        "sustainable buildings news",
        "net zero buildings real estate",
        "green real estate investment news",
        "building decarbonization news",
    ],
    "regulatory": [
        "EU taxonomy real estate update",
        "CSRD real estate reporting",
        "UK MEES regulations update",
        "SEC climate disclosure real estate",
        "ISSB sustainability standards buildings",
    ],
    "research": [
        "GRESB real estate results",
        "green building performance study",
        "ESG property valuation research",
        "carbon risk real estate report",
    ],
    "market": [
        "green bond real estate",
        "sustainable REIT news",
        "PropTech sustainability",
        "green building certification",
    ],
}

DIGEST_TEMPLATE = """
# ESG in Real Estate Weekly Digest
## Week of {date_range}

---

## Executive Summary

{executive_summary}

---

## ðŸ“° News Highlights

{news_highlights}

---

## ðŸ“‹ Regulatory Updates

{regulatory_updates}

---

## ðŸ“Š Research & Reports

{research_reports}

---

## ðŸ’¹ Market Developments

{market_developments}

---

## ðŸŽ¯ Implications

### For Real Estate Investors
{investor_implications}

### For Asset Managers
{manager_implications}

### For ESG Consultants (Plinthos clients)
{consultant_implications}

---

## ðŸ“š Sources

{sources}

---

*Generated by ESG Real Estate Monitor | {generation_date}*
"""

ANALYSIS_PROMPT = """
You are analyzing web search results about ESG in real estate from the past week.

For each search result, extract:
1. Title/headline
2. Source name
3. URL
4. Publication date (if available)
5. Key insight (1-2 sentences)
6. Theme category: one of [carbon_emissions, energy_efficiency, climate_risk, 
   regulation_compliance, green_finance, certification_ratings, proptech_innovation]
7. Geographic scope: UK, EU, US, Global, or specific country
8. Importance: high, medium, or low

Group the results by category and identify:
- The 5 most important stories of the week
- Key themes emerging across sources
- Any regulatory developments requiring attention
- Notable transactions or market movements

Return your analysis in a structured format that can be used to generate a weekly digest.
"""

# =============================================================================
# INSTRUCTIONS FOR CLAUDE CODE
# =============================================================================

CLAUDE_CODE_INSTRUCTIONS = """
## How to Run This Monitor in Claude Code

When you run this in Claude Code, Claude will:

1. **Search Phase**: Execute web searches for each query in SEARCH_QUERIES
   - Claude uses its web_search tool
   - Results are automatically filtered for recency

2. **Fetch Phase**: For key results, fetch full article content
   - Claude uses web_fetch to get complete articles
   - This provides richer context for analysis

3. **Analysis Phase**: Analyze all collected content
   - Categorize by theme
   - Score importance
   - Extract key insights

4. **Synthesis Phase**: Generate the weekly digest
   - Follow the DIGEST_TEMPLATE structure
   - Include all source citations
   - Generate implications for different audiences

5. **Output Phase**: Save results
   - Create markdown file in outputs/
   - Optionally create DOCX via docx skill

### Example Claude Code Prompts

```
Run the ESG in Real Estate monitor for this week and create a digest

Search for ESG real estate news from the past 7 days, analyze it, 
and create a weekly summary following the digest template

Execute the weekly ESG monitor - search all categories, 
analyze the results, and save a digest to outputs/
```

### Manual Step-by-Step

If you prefer to run it step by step:

1. "Search for [category] news from the past week"
2. "Now search for [next category]..."
3. "Analyze all the results and categorize by theme"
4. "Generate the weekly digest following the template"
5. "Save the digest as a markdown file"
"""

# =============================================================================
# HELPER FUNCTIONS
# =============================================================================

def get_all_queries() -> list[str]:
    """Get flat list of all search queries."""
    queries = []
    for category_queries in SEARCH_QUERIES.values():
        queries.extend(category_queries)
    return queries


def get_queries_by_category(category: str) -> list[str]:
    """Get queries for a specific category."""
    return SEARCH_QUERIES.get(category, [])


def format_for_output(content: str, filename: str = None) -> str:
    """Format content for file output."""
    from datetime import datetime
    
    if filename is None:
        filename = f"esg_re_digest_{datetime.now().strftime('%Y-%m-%d')}.md"
    
    return f"outputs/{filename}", content


# =============================================================================
# MAIN
# =============================================================================

if __name__ == "__main__":
    print("ESG in Real Estate Weekly Monitor")
    print("=" * 50)
    print("\nThis script provides configuration for Claude Code.")
    print("To run the monitor, use Claude Code and ask Claude to:")
    print("\n  'Run the ESG real estate weekly monitor'")
    print("\nOr run step by step:")
    print("  1. Search each category in SEARCH_QUERIES")
    print("  2. Analyze results using ANALYSIS_PROMPT")
    print("  3. Generate digest using DIGEST_TEMPLATE")
    print("  4. Save output to outputs/ directory")
    print("\n" + CLAUDE_CODE_INSTRUCTIONS)
